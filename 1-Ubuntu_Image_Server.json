{"status":{},"contains_secrets":true,"product_version":"3.0.0.0","spec":{"description":"","resources":{"client_attrs":{"7b929846-1f2f-4a7b-ea3d-47de2734ea04":{"y":456.0368630348,"x":281.7701864027},"a03790cd_deployment":{"y":307.5027668771,"x":30.0692640414},"07b72cd4-d41f-1a0e-51ac-a5a29328abcf":{"y":642.3432724935,"x":479.1766286989},"ea6b1592-509e-935a-5371-d008c7b4a93a":{"y":643.2663988204,"x":270.4783720885},"48b40f78-258d-47f1-8503-5e519946ff28":{"y":364.5176553701,"x":106.4843159938}},"service_definition_list":[{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Image_server"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"d2235633_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"94942678_runbook","main_task_local_reference":{"kind":"app_task","name":"d2235633_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Image_server"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"05b9bcd8_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"7c83255f_runbook","main_task_local_reference":{"kind":"app_task","name":"05b9bcd8_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Image_server"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"499c6210_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"9657f35c_runbook","main_task_local_reference":{"kind":"app_task","name":"499c6210_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Image_server"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"efb60bb1_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"034e848d_runbook","main_task_local_reference":{"kind":"app_task","name":"efb60bb1_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Image_server"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"96b6d5b2_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"e21320e3_runbook","main_task_local_reference":{"kind":"app_task","name":"96b6d5b2_dag"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[],"name":"Image_server","port_list":[],"tier":"","variable_list":[],"description":""}],"substrate_definition_list":[{"description":"","action_list":[{"description":"","type":"fragment","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"Image_Server_VM"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"37d2207d_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"a51006ba_runbook","main_task_local_reference":{"kind":"app_task","name":"37d2207d_dag"},"variable_list":[]},"name":"pre_action_create"},{"description":"","type":"fragment","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"Image_Server_VM"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"464e628d_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"224e052d_runbook","main_task_local_reference":{"kind":"app_task","name":"464e628d_dag"},"variable_list":[]},"name":"post_action_delete"}],"type":"AHV_VM","name":"Image_Server_VM","readiness_probe":{"connection_type":"SSH","retries":"5","connection_protocol":"","connection_port":22,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"60","disable_readiness_probe":false},"editables":{"create_spec":{"resources":{"nic_list":{},"serial_port_list":{}}}},"os_type":"Linux","create_spec":{"name":"@@{Mgmt_Node_Hostname}@@-vm-@@{calm_array_index}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"7cfb53be-cc07-4c74-8425-6900614c9f28"},"type":""}],"serial_port_list":[{"index":0,"type":"","is_connected":true}],"guest_tools":null,"num_vcpus_per_socket":4,"num_sockets":1,"gpu_list":[],"memory_size_mib":8192,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nusers:\n  - name: ubuntu\n    ssh-authorized-keys:\n      - @@{UBUNTU.public_key}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']"},"type":"","sysprep":null},"power_state":"ON","type":"","account_uuid":"4af301e2-aa0b-4263-a3b2-e315a280c4c9","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","boot_type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","type":"","name":"Ubuntu_16","uuid":"fdcd7f5f-6dc3-448b-800f-a68a8c0ad6ee"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":40960,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":1,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[]}],"credential_definition_list":[{"username":"ubuntu","description":"","type":"KEY","secret":{"attrs":{"is_secret_modified":true,"secret_reference":{}},"value":"BJmb6KAzfOIMGXuGn2tFOVu0tSO+26ZwWa0Ulib53KF0ZxrzsTA2cPKCNhYz9AO5I8wYdU2TFlU3Ul7yRXpQr2nFtBJNCPtqKs7opczsswPFOL3+Ghc0xLQhJfosPN+KZ4dSR5cB6FGw2Jp5n9mN\/Hof5MKbTrLGr4KesgWalyRRY9grRKNMOLu545fvaYj9fzssFT1qFjVZF6fdTmIRuvUy59w15t6NimRxn2S9eXwDsqkAy8r\/wOuxDWdymQ+sfCEKLjK5ZAFeKUMXrrCN1kaKbDNk1aM+ocwDqTw+Dc1XUhgoPAwK+A9kWplq8yPyEG+\/r96POChIUHRnqjzp1UuEEgvyf+1Mn8bFOU8SHttlA13I7GiWiZVO2n9V2v1CC2KSb\/\/6OqygEyBuc6VJ4H3A2vEyogGtHqQyk3CKiRTLbsSO2q0cOjTA3NZceV7H0lm0OPNMXQaYUWQGhrZ44V0hWPrLRZXJ7hnCuWlUFUQkDNLG8u3Y\/fSi4ZKzqWvT28spommTGr8E9RB3G0ktQCwpkl2ueXhlNUspj2\/Eykyjj8bc4kGN7SRfFa2ILWYM0kjO6FoDyiLuwVUPdJdcGmzO5wCTNmFyZ9CSSHL1OaeV6NMC63gsfR0XsC18J\/3YE\/YkMspZ87DAJ9303WO9VDaYHGk8BqYVH4cqYOsn+6Jwj\/gSAN5QBcJyopoHOjgHbyJuyV9LhCJSQ04AudR6I40dItx+3YbyMYPX8E\/S5daBnzLOqtwrpfQXDmHL5X5PpEJDbr\/MbmujXP4CsT0ZnBmNnJ6eaBhKrbG9GliV2K7ObL7IRoh2a3WS5wLr+AC6Ar5ntXxaSc73SFCqC\/9qlca9icrEel0IZFq5p4lfMpTXXo9humltgYQsG\/Ml2SfUr0QGX8Ks7YujQ8lHE7H\/lxqrErtWSV23o7Ksz8J+VYeljA8tFakuYYDvSEnx7xKqV44ztLyvS9ZN+lG\/B+Qp4lgYeJPuKbtLDwdsNgEa\/foW0rTd8ws4BlY33xSuoyKop+TKieztgaQtuesXYsxXhd2Zh31nSApz4pU7WShlWEx4IeulbhUIUhssOOyKeQxxqcg069x1U3MaqyK+k0lKsJVhvdieajIUyQMQAKmSOl7N7+QyTb+QUlX5o\/1WznOh4hzx60kxJ0lfzEt0PEDtrCZSsIb0tQ2vCYAVp17yTBgdF3Kbbszmfi3cfaaxjaES1SYJ1s4530hwOkSniT1za\/BRq1DAPXhskyJhgHTuKJmLjxPj4oUmNVpb2kXycLSuECXh3VHDVE3Nq+kV\/fqQLfc3HbEV4LwoAvIs2eLHYsWhxkE5R3rUFgY0nrqRDlFvEdEaU7re5bEEAVHHTyJ3RGhlHcEaMNVixGPj1IodZQiBRUJTgjLJReawqUdS9k2yUxjECzrcZcHPfTCzsrdiNJD6OeYbS2QS2hZrfblNB3f4rVdVcGueOC+maWtlrLVNzR2tIgzdVPi6t8rAQfvtXheiddYvsKyrYF0oBK5J6RIRWqiVf9Y9LB4h8Zof8hU5oL\/ZdJrlHMhtCK9PQqPF83mftaDcv6bbRRo1ZxLVkU+S5YpoMXXqtwbvUo1UXh+sF8IIKPBeWuQK\/o+urQubgjpWn2BrEcwfJloDS+Wma48lwCqqGhiRyk9POmZagPC+UnBvh3CQBdPuF6Z2qOUKiqmknhRSXJogvagx+J8WnhRop2TCYTNWBmRLsMd803RpVXDLxowMvz9+p\/CONsKFPDfWui\/fNdNMwxI0Qk5iDRfeOs8bi\/r4l7F+MqCRHWu5z1ztzzjEUC2gihbPMR2S2IVNRtLJI1y37jlS9CZ2LOoNsdqsWoKtnPAAa+CfrsaPazvwwJyy9PYtByEUd\/7ie0abhkhP5r\/Ho4Ge1j61HpsftasCiGG2cfs82CPf5wlAtemlgZvyy4zQsq0ORbFSQadsqyIlYnWcXlLtdkxBuXmbfNGUrI02hmLQOKxEhYmzqzTzSoPPuhFWHhbaXDABtLmMvKEbOUJoQZsqUKa4YR52Kj+VQjupngiJJXtSwlrOvk9NlJjdeXUgHd8u4BR38BGMaCAV9Wsw\/TDpSZrKLDeJ7ccC51Qf6Acq7nQJEzknSTUFt4GW0FBFleoqQTBlp+jsyrFpvvbIg8UrluioM5Z7UjOTeiNbwi565cR3\/UJOWyNCw+4TXwQ8yQv7uLBRCB43+YuVia8NYaGYp4Hi53kUitIfAAi0wic4RZVJ+B+Y8tKR\/yX9VUUTTlPDFThlHzyxA7XZShWCw4w=:utf-8"},"name":"UBUNTU"}],"package_definition_list":[{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"Image_server"}],"name":"Ubuntu_Server","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Ubuntu_Server"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"1_Bash_Enablement"},{"kind":"app_task","name":"2_Prereq"}],"name":"e8270e78_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"1_Bash_Enablement"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"2_Prereq"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Image_server"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"1_Bash_Enablement","attrs":{"script":"#!\/bin\/bash\n\nsudo echo \"root:x:0:0:root:\/root:\/bin\/bash\ndaemon:x:1:1:daemon:\/usr\/sbin:\/usr\/sbin\/nologin\nbin:x:2:2:bin:\/bin:\/usr\/sbin\/nologin\nsys:x:3:3:sys:\/dev:\/usr\/sbin\/nologin\nsync:x:4:65534:sync:\/bin:\/bin\/sync\ngames:x:5:60:games:\/usr\/games:\/usr\/sbin\/nologin\nman:x:6:12:man:\/var\/cache\/man:\/usr\/sbin\/nologin\nlp:x:7:7:lp:\/var\/spool\/lpd:\/usr\/sbin\/nologin\nmail:x:8:8:mail:\/var\/mail:\/usr\/sbin\/nologin\nnews:x:9:9:news:\/var\/spool\/news:\/usr\/sbin\/nologin\nuucp:x:10:10:uucp:\/var\/spool\/uucp:\/usr\/sbin\/nologin\nproxy:x:13:13:proxy:\/bin:\/usr\/sbin\/nologin\nwww-data:x:33:33:www-data:\/var\/www:\/usr\/sbin\/nologin\nbackup:x:34:34:backup:\/var\/backups:\/usr\/sbin\/nologin\nlist:x:38:38:Mailing List Manager:\/var\/list:\/usr\/sbin\/nologin\nirc:x:39:39:ircd:\/var\/run\/ircd:\/usr\/sbin\/nologin\ngnats:x:41:41:Gnats Bug-Reporting System (admin):\/var\/lib\/gnats:\/usr\/sbin\/nologin\nnobody:x:65534:65534:nobody:\/nonexistent:\/usr\/sbin\/nologin\nsystemd-timesync:x:100:102:systemd Time Synchronization,,,:\/run\/systemd:\/bin\/false\nsystemd-network:x:101:103:systemd Network Management,,,:\/run\/systemd\/netif:\/bin\/false\nsystemd-resolve:x:102:104:systemd Resolver,,,:\/run\/systemd\/resolve:\/bin\/false\nsystemd-bus-proxy:x:103:105:systemd Bus Proxy,,,:\/run\/systemd:\/bin\/false\nsyslog:x:104:108::\/home\/syslog:\/bin\/false\n_apt:x:105:65534::\/nonexistent:\/bin\/false\nlxd:x:106:65534::\/var\/lib\/lxd\/:\/bin\/false\nmessagebus:x:107:111::\/var\/run\/dbus:\/bin\/false\nuuidd:x:108:112::\/run\/uuidd:\/bin\/false\ndnsmasq:x:109:65534:dnsmasq,,,:\/var\/lib\/misc:\/bin\/false\nsshd:x:110:65534::\/var\/run\/sshd:\/usr\/sbin\/nologin\npollinate:x:111:1::\/var\/cache\/pollinate:\/bin\/false\nubuntu:x:1000:1000::\/home\/ubuntu:\/bin\/bash\n\" | sudo tee \/etc\/passwd\n\nsudo useradd -m nutanix\nsudo echo nutanix:\"nutanix\/4u\"| sudo chpasswd","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"Image_server"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"2_Prereq","attrs":{"script":"#!\/bin\/bash\n\n# Setup the kubernetes preprequisites\n#\nIP_ADDRESS=\"@@{address}@@\"\n\nsudo hostname \"@@{Mgmt_Node_Hostname}@@.@@{Domain}@@\"\nsudo echo \"@@{Mgmt_Node_Hostname}@@.@@{Domain}@@\" | sudo tee \/etc\/hostname\nsudo echo $IP_ADDRESS \"@@{Mgmt_Node_Hostname}@@.@@{Domain}@@\" | sudo tee -a \/etc\/hosts\necho ';'| sudo sfdisk \/dev\/sdb\nsudo mkfs.ext4 \/dev\/sdb1\nsudo e2label \/dev\/sdb1 images\necho \"LABEL=images  \/home\/ubuntu\/images        ext4    defaults    0 0\" | sudo tee -a \/etc\/fstab \n\nsudo mkdir -p \/home\/ubuntu\/images\nsudo mount \/dev\/sdb1 \/home\/ubuntu\/images\/\nsudo apt-get -y update\nsudo apt-get -y install qemu-utils\n\nsudo wget https:\/\/cloud-images.ubuntu.com\/releases\/16.04\/release\/ubuntu-16.04-server-cloudimg-amd64-disk1.img -O \/home\/ubuntu\/images\/ubuntu-16.04-server-cloudimg-amd64-disk1.img\nsudo qemu-img convert -O qcow2 \/home\/ubuntu\/images\/ubuntu-16.04-server-cloudimg-amd64-disk1.img \/home\/ubuntu\/images\/ubuntu-16.04-server-cloudimg-amd64-disk1.qcow2\nsudo sync\n\nSIZE=`sudo qemu-img info \/home\/ubuntu\/images\/ubuntu-16.04-server-cloudimg-amd64-disk1.qcow2 |grep \"virtual size\" | awk {'print $4'} | awk -F\\( {'print $2'}`\nwhile [ $SIZE -lt 50000000000 ]\ndo\n\tsudo qemu-img resize \/home\/ubuntu\/images\/ubuntu-16.04-server-cloudimg-amd64-disk1.qcow2 +50G\n    sleep 5\n    SIZE=`sudo qemu-img info \/home\/ubuntu\/images\/ubuntu-16.04-server-cloudimg-amd64-disk1.qcow2 |grep \"virtual size\" | awk {'print $4'} | awk -F\\( {'print $2'}`\ndone\n\nsudo qemu-img info \/home\/ubuntu\/images\/ubuntu-16.04-server-cloudimg-amd64-disk1.qcow2\n\nsudo apt-get -y install nginx\nsudo ln -s \/home\/ubuntu\/images\/ \/var\/www\/html\/images\n\nsudo echo \" server {\n        listen 80 default_server;\n        listen [::]:80 default_server;\n        root \/var\/www\/html;\n\n        # Add index.php to the list if you are using PHP\n        index index.html index.htm index.nginx-debian.html;\n\n        server_name _;\n\n        location \/ {\n                # First attempt to serve request as file, then\n                # as directory, then fall back to displaying a 404.\n                try_files $uri $uri\/ $uri\/images =404;\n        }\n\n        location \/images {\n               autoindex on;\n        }\n}\" | sudo tee \/etc\/nginx\/sites-enabled\/default\nsudo service nginx restart","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"80ff7566_runbook","main_task_local_reference":{"kind":"app_task","name":"e8270e78_dag"},"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Ubuntu_Server"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"b1ddcb9b_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"d427366b_runbook","main_task_local_reference":{"kind":"app_task","name":"b1ddcb9b_dag"},"variable_list":[]}},"variable_list":[]},{"description":"","action_list":[],"type":"SUBSTRATE_IMAGE","service_local_reference_list":[],"name":"Ubuntu_16","version":"","options":{"type":"","name":"Ubuntu_16.0.4.6","resources":{"image_type":"DISK_IMAGE","checksum":{"checksum_algorithm":"","type":"","checksum_value":""},"source_uri":"https:\/\/cloud-images.ubuntu.com\/releases\/16.04\/release\/ubuntu-16.04-server-cloudimg-amd64-disk1.img","version":{"product_version":"","type":"","product_name":""},"architecture":"X86_64","type":""},"description":""},"variable_list":[]}],"app_profile_list":[{"deployment_create_list":[{"type":"GREENFIELD","action_list":[],"name":"a03790cd_deployment","min_replicas":"1","default_replicas":"1","depends_on_list":[],"published_service_local_reference_list":[],"max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"Ubuntu_Server"}],"substrate_local_reference":{"kind":"app_substrate","name":"Image_Server_VM"},"variable_list":[],"description":""}],"description":"","action_list":[],"name":"Default","variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"Mgmt_Node_Hostname","value":"imageserver","label":"","attrs":{"type":""},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"Domain","value":"ntnxlab.local","label":"","attrs":{"type":""},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}}]}],"published_service_definition_list":[],"default_credential_local_reference":{"kind":"app_credential","name":"UBUNTU"},"type":"USER"},"name":"Ubuntu_Image_Server"},"api_version":"3.0","metadata":{"last_update_time":"1594059152857155","kind":"blueprint","spec_version":21,"creation_time":"1593703645168332","name":"Ubuntu_Image_Server"}}